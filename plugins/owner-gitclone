var baileys = require("@vare/based");
var makeWASocket = baileys.default;
var useMultiFileAuthState = baileys.useMultiFileAuthState;
var DisconnectReason = baileys.DisconnectReason;

var qrcode = require("qrcode-terminal");

async function startBot() {
  var auth = await useMultiFileAuthState("./session");
  var state = auth.state;
  var saveCreds = auth.saveCreds;

  var sock = makeWASocket({
    auth: state,
    printQRInTerminal: true
  });

  sock.ev.on("creds.update", saveCreds);

  sock.ev.on("connection.update", function (update) {
    var connection = update.connection;
    var lastDisconnect = update.lastDisconnect;

    if (connection === "close") {
      var shouldReconnect =
        lastDisconnect &&
        lastDisconnect.error &&
        lastDisconnect.error.output &&
        lastDisconnect.error.output.statusCode !== DisconnectReason.loggedOut;

      if (shouldReconnect) {
        startBot();
      }
    } else if (connection === "open") {
      console.log("âœ… Bot WhatsApp connesso");
    }
  });

  sock.ev.on("messages.upsert", async function (m) {
    var msg = m.messages[0];
    if (!msg.message || msg.key.fromMe) return;

    var from = msg.key.remoteJid;
    var text =
      msg.message.conversation ||
      (msg.message.extendedTextMessage &&
        msg.message.extendedTextMessage.text);

    if (!text) return;

    text = text.toLowerCase();

    // COMANDO gitclone
    if (text === "gitclone") {
      await sock.sendMessage(from, {
        text: "https://github.com/vexper777/vex-bot2"
      });
    }
  });
}

startBot();